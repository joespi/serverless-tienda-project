
service: serverless-tienda-project
frameworkVersion: "3"

plugins:
  - serverless-esbuild

provider:
  name: aws
  runtime: nodejs20.x

stages:
  default:


functions:
  customer:
    handler: src/infra/handlers/customer.handler
    environment: 
      CUSTOMERS_TABLE: !Ref CustomersTable
  product-controller:
    handler: src/infra/handlers/products.handler
    environment: 
      PRODUCTS_TABLE: !Ref ProductsTable
    events:
      - http:
        path: /products
        method: ANY


# you can add CloudFormation resource templates here
resources:
  Resources:
    CustomersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: customers-table-${sls:stage}
        BillingMode: PAY_PER_REQUEST
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH
    ProductsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: products-table-${sls:stage}
        BillingMode: PAY_PER_REQUEST
        AttributeDefinitions:
          - AttributeName: id
            AttributeType: S
        KeySchema:
          - AttributeName: id
            KeyType: HASH

  Outputs:
    CustomersTableName:
      Description: "customers dynamodb table name"
      Value: !Ref CustomersTable
    ProductsTableName:
      Description: "products dynamodb table name"
      Value: !Ref ProductsTable
